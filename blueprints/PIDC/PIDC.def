BootStrap: library
From: ubuntu:sha256.cb37e547a14249943c5a3ee5786502f8db41384deb83fa6d2b62f3c587b82b17

%files
  environment /opt/pidc

%post
  apt update
  apt install -y wget

  cd opt
  wget -O julia.tar.gz https://julialang-s3.julialang.org/bin/linux/x64/1.0/julia-1.0.5-linux-x86_64.tar.gz
  echo "9dedd613777ba6ebd8aee5796915ff50aa6188ea03ed143cb687fc2aefd76b03  julia.tar.gz" | sha256sum -c
  tar xzvf julia.tar.gz
  ln -s julia-1.0.5 julia

  JULIA_DEPOT_PATH=/opt/julia/depot \
    /opt/julia/bin/julia \
      --project=/opt/pidc \
      --print 'using Pkg; Pkg.instantiate()' \
      --load /opt/pidc/precompile.jl

  chmod --recursive a+r /opt/julia/depot

%environment
  export JULIA_DEPOT_PATH="/opt/julia/depot"
  export JULIA_PROJECT=/opt/pidc
  export PATH="/opt/julia/bin:$PATH"

%runscript
  julia "$@"
